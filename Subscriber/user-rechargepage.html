<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Telecom Plans</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

    :root {
        --primary: #4361ee;
        --primary-dark: #3a56d4;
        --secondary: #4cc9f0;
        --dark: #212529;
        --light: #f8f9fa;
        --gray: #6c757d;
        --light-gray: #e9ecef;
        --success: #4BB543;
        --danger: #dc3545;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --border-radius: 12px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Roboto', sans-serif;
        background: var(--light);
        color: var(--dark);
        overflow-x: hidden;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Header Styles */
    header {
        background-color: white;
        box-shadow: var(--shadow);
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
    }

    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
    }

    .logo {
        display: flex;
        align-items: center;
    }

    .logo img {
        height: 50px;
        margin-right: 10px;
        background-color: blue;
        border-radius: 40px;
    }

    .logo h1 {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
    }

    .navbar {
        display: flex;
        gap: 20px;
    }

    .navbar a {
        color: var(--dark);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        transition: color 0.3s;
        position: relative;
    }

    .navbar a:hover {
        color: var(--primary);
    }

    .navbar a::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -5px;
        left: 0;
        background-color: var(--primary);
        transition: width 0.3s;
    }

    .navbar a:hover::after {
        width: 100%;
    }

    .auth-buttons {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .btn {
        padding: 8px 16px;
        border-radius: 50px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
    }

    .btn-outline {
        background: transparent;
        border: 1.5px solid var(--primary);
        color: var(--primary);
    }

    .btn-outline:hover {
        background: var(--primary);
        color: white;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
    }

    .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--dark);
        cursor: pointer;
    }

    /* Dropdown Styles */
    .dropdown-menu {
        min-width: 150px;
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: white;
        border-radius: 8px;
        box-shadow: var(--shadow);
        z-index: 100;
    }

    .dropdown-item {
        display: block;
        padding: 10px 15px;
        color: var(--dark);
        text-decoration: none;
        transition: background 0.3s;
    }

    .dropdown-item:hover {
        background: var(--light-gray);
        color: var(--primary);
    }

    /* Main Content Styles */
    .main-content {
        display: flex;
        margin-top: 80px;
        transition: all 0.3s ease;
    }

    .sidebar {
        width: 250px;
        background: var(--white);
        padding: 2rem;
        height: calc(100vh - 80px);
        position: fixed;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        transform: translateX(0);
        transition: transform 0.3s ease;
        overflow-y: auto;
        z-index: 999;
    }

    .sidebar.active {
        transform: translateX(0);
    }

    .sidebar .mobile-number-box {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); /* Gradient background */
        padding: 1.0rem; /* Slightly more padding for a polished look */
        border: none; /* Remove the border for a cleaner look */
        border-radius: 8px; /* Slightly larger border-radius for smoothness */
        margin-bottom: 1.5rem;
        text-align: left; /* Align text to the left for a professional look */
        font-size: 0.9rem;
        font-weight: 500; /* Bolder font for emphasis */
        color: white; /* White text to contrast with the gradient background */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* Subtle shadow for depth */
        display: flex; /* Flexbox for icon and text alignment */
        align-items: center;
        gap: 0.8rem; /* Space between icon and text */
    }

    /* Add an icon before the mobile number */
    .sidebar .mobile-number-box::before {
        content: "\f095";  /* Font Awesome icon for a phone */
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        font-size: 1rem;
        color: white;
        opacity: 0.9;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .sidebar .mobile-number-box {
            font-size: 0.9rem;
            padding: 0.8rem;
        }
    }

    @media (max-width: 480px) {
        .sidebar .mobile-number-box {
            font-size: 0.8rem;
            padding: 0.6rem;
        }
    }

    .sidebar h3 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
        color: var(--dark);
    }

    .filter-group {
        margin-bottom: 1.5rem;
    }

    .filter-btn {
        display: block;
        width: 100%;
        background: transparent;
        border: 1px solid var(--gray);
        color: var(--dark);
        padding: 0.5rem 1rem;
        margin: 0.3rem 0;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 400;
        text-align: left;
    }

    .filter-btn.active,
    .filter-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .content-area {
        margin-left: 250px;
        padding: 2rem;
        width: calc(100% - 250px);
        transition: all 0.3s ease;
    }

    .breadcrumbs {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 1.5rem;
    }

    .breadcrumbs a {
        color: var(--primary);
        text-decoration: none;
    }

    .search-container {
        position: relative;
        margin: 0 auto 1.5rem;
        max-width: 600px;
    }

    .search-input {
        width: 100%;
        padding: 0.8rem 2.5rem 0.8rem 1rem;
        border-radius: 25px;
        border: 1px solid var(--gray);
        font-size: 1rem;
        transition: all 0.3s;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 5px rgba(30, 136, 229, 0.3);
    }

    .search-icon {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
        cursor: pointer;
    }

    .plans-table-container {
        max-width: 100%;
        overflow-x: auto;
        background-color: #ffffff;
    }

    #plansTable {
        width: 100%;
        border-collapse: collapse;
        background: var(--white);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    #plansTable th,
    #plansTable td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    #plansTable th {
        background: var(--primary);
        color: white;
        font-weight: 500;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    #plansTable tr {
        transition: all 0.3s;
    }

    #plansTable tbody tr:hover {
        background: #f8f8f8;
    }

    #plansTable .plan-features {
        margin: 0;
        padding-left: 1rem;
        list-style: none;
    }

    #plansTable .plan-features li {
        margin: 0.2rem 0;
        font-size: 0.9rem;
        color: var(--dark);
    }

    #plansTable .plan-features li::before {
        content: "â€¢";
        color: var(--primary);
        margin-right: 0.5rem;
    }

    #plansTable .buy-button {
        margin: 0;
        padding: 0.5rem 1.5rem;
        width: auto;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s;
    }

    #plansTable .buy-button:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }

    #scrollTopBtn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: var(--primary);
        color: white;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: none;
        font-size: 1.2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        transition: background 0.3s ease;
        z-index: 1000;
    }

    #scrollTopBtn:hover {
        background: var(--primary-dark);
    }

    .no-results {
        text-align: center;
        padding: 2rem;
        font-size: 1.2rem;
        color: var(--dark);
    }

    /* Responsive Styles */
    @media (max-width: 992px) {
        .content-area {
            margin-left: 0;
            width: 100%;
        }
        .sidebar {
            transform: translateX(-100%);
        }
        .sidebar.active {
            transform: translateX(0);
        }
    }

    @media (max-width: 768px) {
        .header-container {
            padding: 15px;
        }

        .navbar {
            position: fixed;
            top: 70px;
            left: -100%;
            width: 80%;
            height: calc(100vh - 70px);
            background: white;
            flex-direction: column;
            padding: 40px 20px;
            box-shadow: var(--shadow);
            transition: left 0.3s;
            gap: 30px;
        }

        .navbar.active {
            left: 0;
        }

        .mobile-menu-btn {
            display: block;
        }

        .auth-buttons {
            display: flex;
            margin-top: 20px;
        }

        .search-container {
            width: 100%;
        }

        #plansTable th,
        #plansTable td {
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        #plansTable .buy-button {
            padding: 0.3rem 1rem;
            font-size: 0.8rem;
        }

        .sidebar .mobile-number-box {
            font-size: 0.8rem;
            padding: 0.6rem;
        }
    }

    @media (max-width: 480px) {
        .header-container {
            padding: 0.5rem;
        }

        .logo img {
            height: 40px;
        }

        .logo h1 {
            font-size: 1.2rem;
        }

        .search-input {
            padding: 0.6rem 2rem 0.6rem 0.8rem;
            font-size: 0.9rem;
        }

        .search-icon {
            right: 0.8rem;
        }

        #plansTable th,
        #plansTable td {
            padding: 0.3rem;
            font-size: 0.8rem;
        }

        #plansTable .plan-features li {
            font-size: 0.7rem;
        }

        #plansTable .buy-button {
            padding: 0.2rem 0.8rem;
            font-size: 0.7rem;
        }

        .breadcrumbs {
            font-size: 0.8rem;
        }

        .sidebar .mobile-number-box {
            font-size: 0.7rem;
            padding: 0.5rem;
        }
    }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <img src="../Assets/logo-removebg-preview.png" alt="Mobi-comm Logo">
                <h1>Mobi-comm</h1>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="navbar" id="navbar">
                <a href="#recharge">Recharge</a>
                <a href="plansview.html">Plans & Offers</a>
                <a href="Help.html">Support</a>
                <div class="auth-buttons">
                    <div class="login-container" style="position: relative;">
                        <button class="btn btn-outline" id="loginBtn">Login</button>
                        <div id="loginDropdown" class="dropdown-menu">
                            <a href="./Subscriber/user-loginpage.html" class="dropdown-item">User Login</a>
                            <a href="./Admin/admin-loginpage.html" class="dropdown-item">Admin Login</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <div class="main-content">
        <aside class="sidebar">
            <div class="mobile-number-box" id="mobileNumberBox">Mobile Number: Not set</div>
            <h3>Filter Plans</h3>
            <div class="filter-group">
                <label>Plan Category</label>
                <button class="filter-btn active" data-category="all">All Plans</button>
                <button class="filter-btn" data-category="popular">Popular Plans</button>
                <button class="filter-btn" data-category="validity">Validity Plans</button>
                <button class="filter-btn" data-category="data">Data Plans</button>
                <button class="filter-btn" data-category="unlimited">Unlimited Data Plans</button>
            </div>
            <div class="filter-group">
                <label>Validity</label>
                <button class="filter-btn active" data-duration="all">All Durations</button>
                <button class="filter-btn" data-duration="28">28 Days</button>
                <button class="filter-btn" data-duration="30">30 Days</button>
                <button class="filter-btn" data-duration="84">84 Days</button>
                <button class="filter-btn" data-duration="365">365 Days</button>
            </div>
        </aside>

        <main class="content-area">
            <div class="breadcrumbs">
                <a href="../index.html">Home</a> 
                <span>&#47;</span> 
                View plans
            </div>
            

            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search plans by price, data, or features...">
                <span class="search-icon"><i class="fas fa-search"></i></span>
            </div>

            <div class="plans-table-container">
                <table id="plansTable">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Validity</th>
                            <th>Features</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="plansContainer"></tbody>
                </table>
            </div>
        </main>
    </div>

    <button id="scrollTopBtn">â†‘</button>

    <script>
        const plansContainer = document.getElementById('plansContainer');
        const mobileNumberBox = document.getElementById('mobileNumberBox');
        const sidebar = document.querySelector('.sidebar');
        const menuToggle = document.getElementById('mobileMenuBtn');
        const navbar = document.getElementById('navbar');
        const loginBtn = document.getElementById('loginBtn');
        const loginDropdown = document.getElementById('loginDropdown');

        // Toggle mobile menu
        menuToggle.addEventListener('click', () => {
            navbar.classList.toggle('active');
            sidebar.classList.toggle('active');
        });

        // Toggle login dropdown
        loginBtn.addEventListener('click', () => {
            loginDropdown.style.display = loginDropdown.style.display === 'block' ? 'none' : 'block';
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!loginBtn.contains(e.target) && !loginDropdown.contains(e.target)) {
                loginDropdown.style.display = 'none';
            }
            if (window.innerWidth <= 768 && navbar.classList.contains('active')) {
                if (!navbar.contains(e.target) && !menuToggle.contains(e.target)) {
                    navbar.classList.remove('active');
                    sidebar.classList.remove('active');
                }
            }
        });

       // Function to fetch plans from the backend
    async function fetchPlans() {
        try {
            console.log('Fetching plans from http://localhost:8082/api/admin/plans...');
            const response = await fetch('http://localhost:8082/api/admin/plans', {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include'
            });
            console.log('Response status:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const plans = await response.json();
            console.log('Fetched plans:', plans);
            return plans.map(plan => ({
                price: plan.price,
                validity: plan.validity,
                features: plan.features
                    ? plan.features
                        .split(',')
                        .map(feature => feature.trim().replace(/[\[\]"]/g, '')) // Remove [ ], ", and trim whitespace
                    : [],
                category: plan.category || 'General',
                tags: plan.tags ? plan.tags.split(',') : []
            }));
        } catch (error) {
            console.error('Error fetching plans:', error);
            plansContainer.innerHTML = '<tr><td colspan="5">Error loading plans. Check console for details.</td></tr>';
            return [];
        }
    }
        // Function to get query parameter from URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Retrieve and display the mobile number from the URL
        function displayMobileNumber() {
            const mobileNumber = getQueryParam('mobile');
            if (mobileNumber && /^[6-9]\d{9}$/.test(mobileNumber)) {
                mobileNumberBox.textContent = `Mobile Number: ${mobileNumber}`;
                sessionStorage.setItem('mobileNumber', mobileNumber);
            } else {
                const storedMobileNumber = sessionStorage.getItem('mobileNumber');
                if (storedMobileNumber) {
                    mobileNumberBox.textContent = `Mobile Number: ${storedMobileNumber}`;
                } else {
                    mobileNumberBox.textContent = 'Mobile Number: Not set';
                }
            }
        }

        // Filter plans based on criteria
        async function filterPlans(criteria = {}) {
            const plans = await fetchPlans();
            let filteredPlans = [...plans];

            if (criteria.category && criteria.category !== 'all') {
                filteredPlans = filteredPlans.filter(plan => 
                    plan.category.toLowerCase() === criteria.category.toLowerCase()
                );
            }

            if (criteria.duration && criteria.duration !== 'all') {
                const duration = parseInt(criteria.duration);
                filteredPlans = filteredPlans.filter(plan => 
                    plan.validity === duration
                );
            }

            if (criteria.searchTerm) {
                const searchTerm = criteria.searchTerm.toLowerCase();
                filteredPlans = filteredPlans.filter(plan => 
                    plan.price.toString().includes(searchTerm) ||
                    plan.category.toLowerCase().includes(searchTerm) ||
                    plan.features.some(feature => feature.toLowerCase().includes(searchTerm)) ||
                    (plan.tags && plan.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                );
            }

            renderPlans(filteredPlans);
        }

       // Render plans to the table
    function renderPlans(filteredPlans) {
        plansContainer.innerHTML = '';

        if (filteredPlans.length === 0) {
            plansContainer.innerHTML = '<tr><td colspan="5" class="no-results">No plans found. Try a different filter or search term.</td></tr>';
            return;
        }

        filteredPlans.forEach((plan) => {
            const planRow = document.createElement('tr');
            planRow.innerHTML = `
                <td>${plan.category}</td>
                <td>â‚¹${plan.price}</td>
                <td>${plan.validity} Days</td>
                <td>
                    <ul class="plan-features">
                        ${plan.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                </td>
                <td>
                    <button class="buy-button" data-plan="${encodeURIComponent(`${plan.validity} Days â€¢ ${plan.features[0] || 'No features'}`)}" data-price="â‚¹${plan.price}">Buy Now</button>
                </td>
            `;
            plansContainer.appendChild(planRow);
        });

        // Add event listeners to buy buttons after rendering
        document.querySelectorAll('.buy-button').forEach(button => {
            button.addEventListener('click', () => {
                const planDetails = decodeURIComponent(button.getAttribute('data-plan'));
                const price = button.getAttribute('data-price');
                selectPlan(planDetails, price);
            });
        });
    }

        // Handle plan selection
        function selectPlan(planDetails, price) {
            console.log('selectPlan called with:', { planDetails, price });

            let mobileNumber = sessionStorage.getItem('mobileNumber') || getQueryParam('mobile');
            console.log('Retrieved mobile number:', mobileNumber);

            if (!mobileNumber) {
                mobileNumber = '9876543210'; // Fallback for testing
                console.log('No mobile number found, using fallback:', mobileNumber);
            }

            const mobileRegex = /^[6-9]\d{9}$/;
            console.log('Mobile number validation result:', mobileRegex.test(mobileNumber));
            if (!mobileRegex.test(mobileNumber)) {
                console.error('Invalid mobile number:', mobileNumber);
                return;
            }

            sessionStorage.setItem('selectedPlan', planDetails);
            sessionStorage.setItem('selectedPrice', price);
            sessionStorage.setItem('mobileNumber', mobileNumber);
            mobileNumberBox.textContent = `Mobile Number: ${mobileNumber}`;
            console.log('Stored in sessionStorage:', {
                selectedPlan: planDetails,
                selectedPrice: price,
                mobileNumber: mobileNumber
            });

            console.log('Attempting to redirect to user-paymentpage.html...');
            window.location.href = '/Subscriber/user-paymentpage.html';
        }

        // Event listeners for filters
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', () => {
                const group = button.closest('.filter-group');
                group.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const category = button.getAttribute('data-category');
                const duration = button.getAttribute('data-duration');
                filterPlans({ category, duration });
            });
        });

        // Search functionality
        document.querySelector('.search-input').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            filterPlans({ searchTerm });
        });

        // Scroll-to-top button
        window.onscroll = function () {
            let btn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };

        document.getElementById("scrollTopBtn").addEventListener("click", function () {
            window.scrollTo({ top: 0, behavior: "smooth" });
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displayMobileNumber();
            filterPlans();
        });
    </script>
</body>
</html>